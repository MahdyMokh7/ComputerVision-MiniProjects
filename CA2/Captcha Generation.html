<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>SRy90G9vJeDkJFXIyztvupx09LvwbrckKNVqUDTk</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      border: none;
      border-top: 1px solid #1a1a1a;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<div id="d9cc0c19" class="cell markdown">
<h1 id="captcha-generation--recognition">CAPTCHA Generation &amp;
Recognition</h1>
<p><strong>Course: computer vision</strong></p>
<p><strong>Assignment: CA2</strong></p>
<p><strong>Author: Mahdy Mokhtari</strong></p>
<p><strong>Student ID: 810101515</strong></p>
<hr />
<h3 id="project-overview">Project Overview</h3>
<p>This project focuses on <strong>image processing</strong>,
<strong>CAPTCHA generation</strong>, <strong>denoising</strong>,
<strong>deblurring</strong>, <strong>segmentation</strong>, and
<strong>character recognition without machine learning (Non-ML
OCR)</strong>.<br />
You will generate your own CAPTCHA dataset, apply classical image
processing pipelines, segment characters, and finally recognize
characters using similarity-based metrics.</p>
<p>The notebook contains four main parts, following the assignment
specification.</p>
<hr />
<h3 id="part-1--data-generation-captcha-generation">Part 1 — Data
Generation (Captcha Generation)</h3>
<p>In this section:</p>
<ul>
<li>Generate <strong>10 CAPTCHA images</strong>, each containing
<strong>3 random characters</strong> (lowercase English letters +
digits).<br />
</li>
<li>Use <strong>Pillow</strong> to render the images.<br />
</li>
<li>Add <strong>salt &amp; pepper noise</strong> to each image and
compare with the originals.<br />
</li>
<li>Apply a <strong>blurring kernel</strong> of your choice and explain
the reason behind choosing that kernel.</li>
</ul>
<p><strong>Expected Output:</strong><br />
A final set of CAPTCHA images + noisy versions + blurred versions.</p>
<hr />
<h3 id="part-2--preprocessing">Part 2 — Preprocessing</h3>
<p>You will apply classical preprocessing techniques to improve image
quality:</p>
<ul>
<li>Explain why blurring kernels can remove noise.<br />
</li>
<li>Use a <em>different</em> kernel from Part 1 to reduce noise as much
as possible.<br />
</li>
<li>Apply <strong>Sharpening</strong> or <strong>De-blurring</strong>
(research-based) and justify your choice.<br />
</li>
<li>Perform <strong>thresholding</strong> to create clean binary images
suitable for segmentation.</li>
</ul>
<hr />
<h3 id="part-3--segmentation">Part 3 — Segmentation</h3>
<p>Steps:</p>
<ul>
<li>Extract all characters from each CAPTCHA image using binary
segmentation.<br />
</li>
<li>Report number of extracted characters per sample.<br />
</li>
<li>Resize each segmented character to <strong>64×64</strong>
pixels.<br />
</li>
<li>Save all segmented characters in a dedicated folder.</li>
</ul>
<hr />
<h3 id="part-4--character-recognition">Part 4 — Character
Recognition</h3>
<p>Using the provided <strong>Mapset</strong> (reference
characters):</p>
<ul>
<li>Use <strong>non-learning similarity methods</strong>, such as:
<ul>
<li>Correlation<br />
</li>
<li>Statistical measures<br />
</li>
<li>Structural similarity<br />
</li>
<li>Feature-based distance metrics<br />
</li>
</ul></li>
<li>Match each segmented character to its closest reference
character.<br />
</li>
<li>Save final results and accuracy metrics in a <strong>CSV
file</strong>.</li>
</ul>
<hr />
<h3 id="allowed-libraries">Allowed Libraries</h3>
<p>You are free to use standard Python image-processing libraries:</p>
<ul>
<li><strong>OpenCV (cv2)</strong><br />
</li>
<li><strong>Pillow (PIL)</strong><br />
</li>
<li><strong>NumPy</strong><br />
</li>
<li><strong>Matplotlib</strong><br />
</li>
<li><strong>scipy</strong> (for filters, correlations, convolution,
etc.)</li>
</ul>
</div>
<div id="82c1907a" class="cell markdown">
<h2 id="captcha-generation">Captcha Generation</h2>
</div>
<div id="464f79c4" class="cell markdown">
<h3 id="generate-10-captcha-images">Generate 10 captcha images</h3>
</div>
<div id="6c470fcf" class="cell code" data-execution_count="47">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> ImageFilter, ImageFont, ImageDraw, Image</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>OUT_DIR <span class="op">=</span> <span class="st">&quot;Captcha&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>os.makedirs(OUT_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>WIDTH, HEIGHT <span class="op">=</span> <span class="dv">200</span>, <span class="dv">100</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>N_SAMPLES <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>CHARS <span class="op">=</span> string.ascii_lowercase <span class="op">+</span> string.digits</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>FONT_SIZE <span class="op">=</span> <span class="dv">40</span></span></code></pre></div>
</div>
<div id="accc3c3d" class="cell code" data-execution_count="48">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>font <span class="op">=</span> ImageFont.truetype(<span class="st">&quot;arial.ttf&quot;</span>, FONT_SIZE)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_captcha(text):</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.new(<span class="st">&quot;RGB&quot;</span>, (WIDTH, HEIGHT), (<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    draw <span class="op">=</span> ImageDraw.Draw(img)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> draw.textbbox((<span class="dv">0</span>, <span class="dv">0</span>), text, font<span class="op">=</span>font)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    text_w <span class="op">=</span> bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    text_h <span class="op">=</span> bbox[<span class="dv">3</span>] <span class="op">-</span> bbox[<span class="dv">1</span>]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> (WIDTH <span class="op">-</span> text_w) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> (HEIGHT <span class="op">-</span> text_h) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    draw.text((x, y), text, font<span class="op">=</span>font, fill<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    text_mask <span class="op">=</span> Image.new(<span class="st">&quot;L&quot;</span>, (WIDTH, HEIGHT), <span class="dv">255</span>)  </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    mask_draw <span class="op">=</span> ImageDraw.Draw(text_mask)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    mask_draw.text((x, y), text, font<span class="op">=</span>font, fill<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> img</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(CHARS))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(CHARS)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;str&#39;&gt;
abcdefghijklmnopqrstuvwxyz0123456789
</code></pre>
</div>
</div>
<div id="5cc813dd" class="cell code" data-execution_count="49">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shutil.rmtree(OUT_DIR)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># shutil.rmtree(OUT_NOISE_DIR)</span></span></code></pre></div>
</div>
<div id="b8ea6a9f" class="cell code" data-execution_count="50">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N_SAMPLES):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">&#39;&#39;</span>.join(random.choices(CHARS, k<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> generate_captcha(text)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    img.save(os.path.join(OUT_DIR, <span class="ss">f&quot;</span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>i<span class="sc">:02d}</span><span class="ss">.png&quot;</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>N_SAMPLES<span class="sc">}</span><span class="ss"> samples &#39;</span><span class="sc">{</span>OUT_DIR<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>10 samples &#39;Captcha&#39;
</code></pre>
</div>
</div>
<div id="bf651c3a" class="cell markdown">
<h3 id="salt--pepper-filter">Salt &amp; Pepper Filter</h3>
</div>
<div id="a5c11611" class="cell code" data-execution_count="51">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>OUT_NOISE_DIR <span class="op">=</span> <span class="st">&quot;Captcha-Noise&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>os.makedirs(OUT_NOISE_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_salt_pepper_noise(image, amount<span class="op">=</span><span class="fl">0.02</span>, salt_vs_pepper<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    noisy <span class="op">=</span> image.copy()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> image.shape[:<span class="dv">2</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    num_salt <span class="op">=</span> <span class="bu">int</span>(amount <span class="op">*</span> h <span class="op">*</span> w <span class="op">*</span> salt_vs_pepper)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    num_pepper <span class="op">=</span> <span class="bu">int</span>(amount <span class="op">*</span> h <span class="op">*</span> w <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> salt_vs_pepper))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Salt noise</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    y_coords <span class="op">=</span> np.random.randint(<span class="dv">0</span>, h, num_salt)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    x_coords <span class="op">=</span> np.random.randint(<span class="dv">0</span>, w, num_salt)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> image.ndim <span class="op">==</span> <span class="dv">2</span>:  <span class="co"># grayscale</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        noisy[y_coords, x_coords] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># color</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        noisy[y_coords, x_coords] <span class="op">=</span> [<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>]</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pepper noise</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    y_coords <span class="op">=</span> np.random.randint(<span class="dv">0</span>, h, num_pepper)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    x_coords <span class="op">=</span> np.random.randint(<span class="dv">0</span>, w, num_pepper)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> image.ndim <span class="op">==</span> <span class="dv">2</span>:  <span class="co"># grayscale</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        noisy[y_coords, x_coords] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># color</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        noisy[y_coords, x_coords] <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> noisy</span></code></pre></div>
</div>
<div id="e5c9ea7c" class="cell code" data-execution_count="52">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(OUT_DIR) <span class="kw">and</span> os.path.isdir(OUT_DIR):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(OUT_DIR):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(OUT_DIR, filename)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> cv2.imread(file_path, cv2.IMREAD_GRAYSCALE)  <span class="co"># or IMREAD_COLOR</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Skipping unreadable file: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            noisy_img <span class="op">=</span> add_salt_pepper_noise(img, amount<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save output (overwrite or change name)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            output_path <span class="op">=</span> os.path.join(OUT_NOISE_DIR, <span class="ss">f&quot;noisy_</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            cv2.imwrite(output_path, noisy_img)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Saved noisy image: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;OUT_DIR does not exist.&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Saved noisy image: Captcha-Noise\noisy_2hr_02.png
Saved noisy image: Captcha-Noise\noisy_83z_01.png
Saved noisy image: Captcha-Noise\noisy_hfx_05.png
Saved noisy image: Captcha-Noise\noisy_j1k_07.png
Saved noisy image: Captcha-Noise\noisy_jth_06.png
Saved noisy image: Captcha-Noise\noisy_l5s_04.png
Saved noisy image: Captcha-Noise\noisy_nd0_08.png
Saved noisy image: Captcha-Noise\noisy_pkn_00.png
Saved noisy image: Captcha-Noise\noisy_qch_09.png
Saved noisy image: Captcha-Noise\noisy_x0f_03.png
</code></pre>
</div>
</div>
<div id="75e7a274" class="cell markdown">
<p>Now we are comparing the original generated vs the salt and pepper
noise applyed images.</p>
</div>
<div id="6ff7a285" class="cell code" data-execution_count="54">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>files_out <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>files_noise <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_NOISE_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>img1_path <span class="op">=</span> os.path.join(OUT_DIR, files_out[idx])</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>img2_path <span class="op">=</span> os.path.join(OUT_NOISE_DIR, files_noise[idx])</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> cv2.imread(img1_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> cv2.imread(img2_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Original&quot;</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(img1, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Noisy&quot;</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>plt.imshow(img2, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="a4bc3c44f3d18c324573df2df35c064a7c09efda.png" /></p>
</div>
</div>
<div id="60224b65" class="cell markdown">
<h3 id="gaussian-blur">Gaussian BLur</h3>
<p>This kernal is one of the kernels that does the blur filtering on an
image. We had other choices like mean but this one for captcha is better
because its a weighted blur so the picture will not loose its identity
in the sense of we have characters and the rest is white so regular mean
could cuase the characters to not be recognized even by humnas.</p>
<ul>
<li><p>Gaussian blur preserves shapes better.</p></li>
<li><p>Gaussian kernels model real-world blur</p></li>
</ul>
</div>
<div id="f6cab1a9" class="cell code" data-execution_count="53">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>OUT_NOISE_BLUR_DIR <span class="op">=</span> <span class="st">&quot;Captcha-Noise-Blur&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>os.makedirs(OUT_NOISE_BLUR_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(OUT_NOISE_DIR) <span class="kw">and</span> os.path.isdir(OUT_NOISE_DIR):</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(OUT_NOISE_DIR):</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            input_path <span class="op">=</span> os.path.join(OUT_NOISE_DIR, filename)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            output_path <span class="op">=</span> os.path.join(OUT_NOISE_BLUR_DIR, filename)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> cv2.imread(input_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Skipping unreadable file: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Gaussian blur</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            blurred_img <span class="op">=</span> cv2.GaussianBlur(img, (<span class="dv">5</span>, <span class="dv">5</span>), <span class="dv">0</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            cv2.imwrite(output_path, blurred_img)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Blurred image saved: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;DIR_NOISE_OUT does not exist.&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Blurred image saved: Captcha-Noise-Blur\noisy_2hr_02.png
Blurred image saved: Captcha-Noise-Blur\noisy_83z_01.png
Blurred image saved: Captcha-Noise-Blur\noisy_hfx_05.png
Blurred image saved: Captcha-Noise-Blur\noisy_j1k_07.png
Blurred image saved: Captcha-Noise-Blur\noisy_jth_06.png
Blurred image saved: Captcha-Noise-Blur\noisy_l5s_04.png
Blurred image saved: Captcha-Noise-Blur\noisy_nd0_08.png
Blurred image saved: Captcha-Noise-Blur\noisy_pkn_00.png
Blurred image saved: Captcha-Noise-Blur\noisy_qch_09.png
Blurred image saved: Captcha-Noise-Blur\noisy_x0f_03.png
</code></pre>
</div>
</div>
<div id="1211d7b6" class="cell code" data-execution_count="58">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>files_noise <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_NOISE_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>files_noise_blurred <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_NOISE_BLUR_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>img1_path <span class="op">=</span> os.path.join(OUT_NOISE_DIR, files_noise[idx])</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>img2_path <span class="op">=</span> os.path.join(OUT_NOISE_BLUR_DIR, files_noise_blurred[idx])</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> cv2.imread(img1_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> cv2.imread(img2_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Original&quot;</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(img1, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Noisy&quot;</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>plt.imshow(img2, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="638f2abafc89b1821e6f4d99742b83f86c7f4700.png" /></p>
</div>
</div>
<div id="a2ec8809" class="cell markdown">
<h2 id="data-pre-processing">Data Pre-processing</h2>
</div>
<div id="5580bf55" class="cell markdown">
<h3 id="removing-noise">Removing Noise</h3>
<h4
id="why-do-filters-that-blur-an-image-also-can-remove-some-noises">Why
do filters that blur an image, also can remove some noises?</h4>
<p>To reason to this is that when we are bluring we are smoothing the
pixels and getting the newr by pixels more near and less distance in
terms of pixel values. The noises are mostly some unwanted pixels in the
middle of other pixels that differ from neighboring pixels and the
bluring becasue it gets them more to be alike in terms of value the
noises some how get smoother and disapear in some degree.</p>
</div>
<div id="12a3e9f4" class="cell code" data-execution_count="68">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>OUT_CLEANED_DIR <span class="op">=</span> <span class="st">&quot;Captcha-Cleaned&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>os.makedirs(OUT_CLEANED_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> os.listdir(OUT_NOISE_BLUR_DIR):</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filename.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        input_path <span class="op">=</span> os.path.join(OUT_NOISE_BLUR_DIR, filename)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        output_path <span class="op">=</span> os.path.join(OUT_CLEANED_DIR, filename)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> cv2.imread(input_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Skipping unreadable file: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        cleaned_img <span class="op">=</span> cv2.medianBlur(img, <span class="dv">5</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        cv2.imwrite(output_path, cleaned_img)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Cleaned image saved: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Cleaned image saved: Captcha-Cleaned\noisy_2hr_02.png
Cleaned image saved: Captcha-Cleaned\noisy_83z_01.png
Cleaned image saved: Captcha-Cleaned\noisy_hfx_05.png
Cleaned image saved: Captcha-Cleaned\noisy_j1k_07.png
Cleaned image saved: Captcha-Cleaned\noisy_jth_06.png
Cleaned image saved: Captcha-Cleaned\noisy_l5s_04.png
Cleaned image saved: Captcha-Cleaned\noisy_nd0_08.png
Cleaned image saved: Captcha-Cleaned\noisy_pkn_00.png
Cleaned image saved: Captcha-Cleaned\noisy_qch_09.png
Cleaned image saved: Captcha-Cleaned\noisy_x0f_03.png
</code></pre>
</div>
</div>
<div id="4a6fd3fe" class="cell code" data-execution_count="69">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>files_noise_blurred <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_NOISE_BLUR_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>files_cleaned <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_CLEANED_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>img1_path <span class="op">=</span> os.path.join(OUT_NOISE_BLUR_DIR, files_noise_blurred[idx])</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>img2_path <span class="op">=</span> os.path.join(OUT_CLEANED_DIR, files_cleaned[idx])</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> cv2.imread(img1_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> cv2.imread(img2_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Original&quot;</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(img1, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Noisy&quot;</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>plt.imshow(img2, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="73372d918a801372c1fd224cbfd961700563d3e4.png" /></p>
</div>
</div>
<div id="b3c8c90a" class="cell markdown">
<h3 id="removing-blur">Removing Blur</h3>
<h4 id="what-is-sharpening-">What is <strong>Sharpening</strong> ?</h4>
<p>Sharpening is a mehtod that we enhance the image to see better
details and we shrarpen hte edges so we will see the edges more clearly.
Somehow the opposite of blurring, because in bluring we make the edges
disapear and smooths intensity changes but sharpening boosts intensity
changes. In sharpening we are adding scaled version of the edges back to
the image. Mathematically its done by subtracting a blurred version of
the image from the original, then amplifying the difference. In
practice</p>
<h4 id="what-is-de-blurring-">What is <strong>De-blurring</strong>
?</h4>
<p>We exactly reverse the operation we do in bluring and here we try to
reverse the convolution. Image deblurring is the mathematical process of
undoing blur (convolution) using <strong>deconvolution</strong>
techniques or AI-based restoration models.</p>
<hr />
<p><strong>NOTE: (GPT5 Generated comparisson)</strong> Deblurring vs.
Sharpening</p>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;"><strong>Sharpening</strong></th>
<th style="text-align: left;"><strong>Deblurring</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Purpose</strong></td>
<td style="text-align: left;">Enhances the <em>appearance</em> of
sharpness by increasing edge contrast</td>
<td style="text-align: left;">Attempts to <em>recover</em> the original,
unblurred image by reversing the blur process</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Core Idea</strong></td>
<td style="text-align: left;">Adds or amplifies high-frequency
details</td>
<td style="text-align: left;">Performs <em>deconvolution</em> to invert
the blur (convolution) mathematically</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;">Usually a normal or slightly blurred
image</td>
<td style="text-align: left;">A noticeably blurred image</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;">Visually crisper image (but not
necessarily accurate)</td>
<td style="text-align: left;">Restored image that approximates the true
original</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Mathematical Model</strong></td>
<td style="text-align: left;">Edge enhancement: <br> (\text{Sharpened} =
I + \alpha (I - \text{Blur}(I)))</td>
<td style="text-align: left;">Image restoration: <br> (\hat{I} =
\text{Deconvolve}(B, K)), where (B = I * K + N)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Requires Blur Kernel
(K)?</strong></td>
<td style="text-align: left;">❌ No</td>
<td style="text-align: left;">✅ Yes (or estimated)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Works in Frequency
Domain?</strong></td>
<td style="text-align: left;">Boosts high frequencies</td>
<td style="text-align: left;">Reconstructs full frequency spectrum</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Noise Sensitivity</strong></td>
<td style="text-align: left;">Moderate — may exaggerate noise
slightly</td>
<td style="text-align: left;">High — inversion can strongly amplify
noise</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Techniques</strong></td>
<td style="text-align: left;">Unsharp Mask, High-Pass Filter,
Laplacian</td>
<td style="text-align: left;">Wiener Filter, Richardson–Lucy, Blind
Deconvolution</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Speed / Complexity</strong></td>
<td style="text-align: left;">Fast and simple (real-time possible)</td>
<td style="text-align: left;">Computationally expensive and
iterative</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Goal Type</strong></td>
<td style="text-align: left;"><em>Perceptual enhancement</em></td>
<td style="text-align: left;"><em>Physical restoration</em></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Limitations</strong></td>
<td style="text-align: left;">Cannot restore lost detail — only fakes
sharpness</td>
<td style="text-align: left;">Can reconstruct lost details but often
unstable with unknown blur</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Used In</strong></td>
<td style="text-align: left;">Photography apps, image enhancement,
computer vision preprocessing</td>
<td style="text-align: left;">Scientific imaging, microscopy, astronomy,
motion correction</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="which-one-do-we-pick-in-our-case">Which one do we pick in our
case?</h4>
<p>According to the Gaussian blur that we have done and the task that we
have is a traditional OCR, we are picking the <strong>Richardson–Lucy
De-blurring(RL)</strong>. We could easily adjust the PSF(point spread
function) and model it. RL assumes a PSF and iteratively recovers
high-frequency detail — it tends to preserve edges and works well for
text/characters.</p>
<p>It is iterative and allows a trade-off (iterations) between recovery
and artifact amplification — good for OCR tuning.</p>
</div>
<div id="a3786c9c" class="cell code" data-execution_count="70">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shutil.rmtree(OUT_DEBLURRED_DIR)</span></span></code></pre></div>
</div>
<div id="f45c1677" class="cell code" data-execution_count="71">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage.restoration <span class="im">import</span> richardson_lucy</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>OUT_CLEANED_DIR  <span class="co"># blurred+denoised images</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>OUT_DEBLURRED_DIR <span class="op">=</span> <span class="st">&quot;Captcha-Deblurred-RL&quot;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>os.makedirs(OUT_DEBLURRED_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gaussian_psf(size<span class="op">=</span><span class="dv">5</span>, sigma<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    k1d <span class="op">=</span> cv2.getGaussianKernel(size, sigma)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    psf <span class="op">=</span> np.outer(k1d, k1d)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    psf <span class="op">/=</span> psf.<span class="bu">sum</span>()</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> psf</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>psf <span class="op">=</span> gaussian_psf(size<span class="op">=</span><span class="dv">5</span>, sigma<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>iterations <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fname <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(OUT_CLEANED_DIR)):</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> fname.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    img_path <span class="op">=</span> os.path.join(OUT_CLEANED_DIR, fname)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(img_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;skip&quot;</span>, fname)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    img_f <span class="op">=</span> img.astype(np.float64) <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    pad <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    img_padded <span class="op">=</span> cv2.copyMakeBorder(img_f, pad, pad, pad, pad, cv2.BORDER_REFLECT)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Richardson Lucy De-Convolution</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    deconv <span class="op">=</span> richardson_lucy(img_padded, psf, num_iter<span class="op">=</span>iterations, clip<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    deconv <span class="op">=</span> deconv[pad:<span class="op">-</span>pad, pad:<span class="op">-</span>pad]</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    deconv <span class="op">=</span> np.clip(deconv, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> (deconv <span class="op">*</span> <span class="dv">255</span>).astype(np.uint8)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    cv2.imwrite(os.path.join(OUT_DEBLURRED_DIR, fname), out)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;saved&quot;</span>, fname)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>saved noisy_2hr_02.png
saved noisy_83z_01.png
saved noisy_hfx_05.png
saved noisy_j1k_07.png
saved noisy_jth_06.png
saved noisy_l5s_04.png
saved noisy_nd0_08.png
saved noisy_pkn_00.png
saved noisy_qch_09.png
saved noisy_x0f_03.png
</code></pre>
</div>
</div>
<div id="eb4f6340" class="cell code" data-execution_count="72">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>files_cleaned <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_CLEANED_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>files_deblured <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_DEBLURRED_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>img1_path <span class="op">=</span> os.path.join(OUT_CLEANED_DIR, files_cleaned[idx])</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>img2_path <span class="op">=</span> os.path.join(OUT_DEBLURRED_DIR, files_deblured[idx])</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> cv2.imread(img1_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> cv2.imread(img2_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Original&quot;</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(img1, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Noisy&quot;</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>plt.imshow(img2, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="f17c248aca720e79504fa7b9ab9b4faeb44d1b3b.png" /></p>
</div>
</div>
<div id="e58c7bce" class="cell markdown">
<h3 id="convert-to-binary">Convert to Binary</h3>
</div>
<div id="943e6cac" class="cell code" data-execution_count="73">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>OUT_DEBLURRED_DIR</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>OUT_BINARY_DIR <span class="op">=</span> <span class="st">&quot;Captcha-Binary&quot;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>os.makedirs(OUT_BINARY_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>threshold_area <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fname <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(OUT_DEBLURRED_DIR)):</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> fname.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    img_path <span class="op">=</span> os.path.join(OUT_DEBLURRED_DIR, fname)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(img_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;skip&quot;</span>, fname)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    _, binary <span class="op">=</span> cv2.threshold(img, <span class="dv">0</span>, <span class="dv">255</span>, cv2.THRESH_BINARY <span class="op">+</span> cv2.THRESH_OTSU)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    num_labels, labels, stats, _ <span class="op">=</span> cv2.connectedComponentsWithStats(<span class="dv">255</span> <span class="op">-</span> binary, connectivity<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_labels):</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        area <span class="op">=</span> stats[i, cv2.CC_STAT_AREA]</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> area <span class="op">&lt;</span> threshold_area:</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>            binary[labels <span class="op">==</span> i] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    cv2.imwrite(os.path.join(OUT_BINARY_DIR, fname), binary)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;saved&quot;</span>, fname)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>saved noisy_2hr_02.png
saved noisy_83z_01.png
saved noisy_hfx_05.png
saved noisy_j1k_07.png
saved noisy_jth_06.png
saved noisy_l5s_04.png
saved noisy_nd0_08.png
saved noisy_pkn_00.png
saved noisy_qch_09.png
saved noisy_x0f_03.png
</code></pre>
</div>
</div>
<div id="5c7fb6d9" class="cell code">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>files_deblured <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_DEBLURRED_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>files_binary <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_BINARY_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>img1_path <span class="op">=</span> os.path.join(OUT_DEBLURRED_DIR, files_deblured[idx])</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>img2_path <span class="op">=</span> os.path.join(OUT_BINARY_DIR, files_binary[idx])</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> cv2.imread(img1_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> cv2.imread(img2_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Deblured&quot;</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(img1, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Binary&quot;</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>plt.imshow(img2, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="4987eaed9181761a363e923e3829d352be724036.png" /></p>
</div>
</div>
<div id="1646f86c" class="cell markdown">
<h2 id="segmentation">Segmentation</h2>
</div>
<div id="0ec11552" class="cell code">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shutil.rmtree(OUT_CHAR_DIR)</span></span></code></pre></div>
</div>
<div id="ad406b8b" class="cell code" data-execution_count="82">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>OUT_BINARY_DIR</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>OUT_CHAR_DIR <span class="op">=</span> <span class="st">&quot;Captcha-Characters&quot;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>os.makedirs(OUT_CHAR_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>character_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fname <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(OUT_BINARY_DIR)):</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> fname.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    img_path <span class="op">=</span> os.path.join(OUT_BINARY_DIR, fname)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(img_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;skip&quot;</span>, fname)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    _, binary <span class="op">=</span> cv2.threshold(img, <span class="dv">0</span>, <span class="dv">255</span>, cv2.THRESH_BINARY <span class="op">+</span> cv2.THRESH_OTSU)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    white_ratio <span class="op">=</span> np.mean(binary)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> white_ratio <span class="op">&gt;</span> <span class="dv">127</span>:</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        binary <span class="op">=</span> <span class="dv">255</span> <span class="op">-</span> binary</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    contours, _ <span class="op">=</span> cv2.findContours(binary, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    contours <span class="op">=</span> <span class="bu">sorted</span>(contours, key<span class="op">=</span><span class="kw">lambda</span> c: cv2.boundingRect(c)[<span class="dv">0</span>])</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, contour <span class="kw">in</span> <span class="bu">enumerate</span>(contours):</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cv2.contourArea(contour) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        x, y, w, h <span class="op">=</span> cv2.boundingRect(contour)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        char_image <span class="op">=</span> binary[y:y<span class="op">+</span>h, x:x<span class="op">+</span>w]</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># resize to 64x64</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        char_resized <span class="op">=</span> cv2.resize(char_image, (<span class="dv">64</span>, <span class="dv">64</span>), interpolation<span class="op">=</span>cv2.INTER_AREA)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>        char_filename <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>splitext(fname)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">_char_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.png&quot;</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>        cv2.imwrite(os.path.join(OUT_CHAR_DIR, char_filename), char_resized)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>        character_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Total characters extracted: </span><span class="sc">{</span>character_count<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Total characters extracted: 29
</code></pre>
</div>
</div>
<div id="92690be5" class="cell code" data-execution_count="83">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># choose index of CAPTCHA</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span>  </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get binary image filenames</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>files_binary <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_BINARY_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>img_name <span class="op">=</span> os.path.splitext(files_binary[idx])[<span class="dv">0</span>]</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># paths</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>img_path <span class="op">=</span> os.path.join(OUT_BINARY_DIR, files_binary[idx])</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>char_files <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_CHAR_DIR) <span class="cf">if</span> f.startswith(img_name) <span class="kw">and</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># load images</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> cv2.imread(img_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>char_imgs <span class="op">=</span> [cv2.imread(os.path.join(OUT_CHAR_DIR, cf), cv2.IMREAD_GRAYSCALE) <span class="cf">for</span> cf <span class="kw">in</span> char_files]</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot original + characters</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">3</span>))</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="bu">len</span>(char_imgs) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Binary (Full)&quot;</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>plt.imshow(img, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, cimg <span class="kw">in</span> <span class="bu">enumerate</span>(char_imgs):</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="bu">len</span>(char_imgs) <span class="op">+</span> <span class="dv">1</span>, i <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&quot;Char </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    plt.imshow(cimg, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="ec59fc39a628cff2cb06c20860c95dde21192d52.png" /></p>
</div>
</div>
<div id="2868498c" class="cell code" data-execution_count="84">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># choose index of CAPTCHA</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">1</span>  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get binary image filenames</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>files_binary <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_BINARY_DIR) <span class="cf">if</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>img_name <span class="op">=</span> os.path.splitext(files_binary[idx])[<span class="dv">0</span>]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># paths</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>img_path <span class="op">=</span> os.path.join(OUT_BINARY_DIR, files_binary[idx])</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>char_files <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(OUT_CHAR_DIR) <span class="cf">if</span> f.startswith(img_name) <span class="kw">and</span> f.lower().endswith(<span class="st">&quot;.png&quot;</span>)])</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># load images</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> cv2.imread(img_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>char_imgs <span class="op">=</span> [cv2.imread(os.path.join(OUT_CHAR_DIR, cf), cv2.IMREAD_GRAYSCALE) <span class="cf">for</span> cf <span class="kw">in</span> char_files]</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot original + characters</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">3</span>))</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="bu">len</span>(char_imgs) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Binary (Full)&quot;</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>plt.imshow(img, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, cimg <span class="kw">in</span> <span class="bu">enumerate</span>(char_imgs):</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="bu">len</span>(char_imgs) <span class="op">+</span> <span class="dv">1</span>, i <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&quot;Char </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    plt.imshow(cimg, cmap<span class="op">=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="4e61af01a00d58068bf1a0319f373fef20a28eaa.png" /></p>
</div>
</div>
<div id="827c0ad5" class="cell markdown">
<h2 id="character-recognition">Character Recognition</h2>
</div>
<div id="a9c22628" class="cell code" data-execution_count="88">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>MAPSET_DIR <span class="op">=</span> os.path.join(<span class="st">&quot;Mapset&quot;</span>, <span class="st">&quot;Mapset&quot;</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>OUTPUT_CSV <span class="op">=</span> <span class="st">&quot;char_predictions.csv&quot;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># load all templates (mapset)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>templates <span class="op">=</span> {}</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fname <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(MAPSET_DIR)):</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> fname.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> os.path.splitext(fname)[<span class="dv">0</span>]  <span class="co"># &#39;a&#39;, &#39;3&#39;</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> os.path.join(MAPSET_DIR, fname)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    templates[label] <span class="op">=</span> cv2.resize(img, (<span class="dv">64</span>, <span class="dv">64</span>), interpolation<span class="op">=</span>cv2.INTER_AREA)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fname <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(OUT_CHAR_DIR)):</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> fname.lower().endswith(<span class="st">&quot;.png&quot;</span>):</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    seg_path <span class="op">=</span> os.path.join(OUT_CHAR_DIR, fname)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    seg_img <span class="op">=</span> cv2.imread(seg_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> seg_img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    seg_img <span class="op">=</span> cv2.resize(seg_img, (<span class="dv">64</span>, <span class="dv">64</span>), interpolation<span class="op">=</span>cv2.INTER_AREA)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    best_label <span class="op">=</span> <span class="va">None</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    best_corr <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, tmpl <span class="kw">in</span> templates.items():</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        seg_norm <span class="op">=</span> ((seg_img <span class="op">-</span> np.mean(seg_img)) <span class="op">/</span> (np.std(seg_img) <span class="op">+</span> <span class="fl">1e-6</span>)).astype(np.float32)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>        tmpl_norm <span class="op">=</span> ((tmpl <span class="op">-</span> np.mean(tmpl)) <span class="op">/</span> (np.std(tmpl) <span class="op">+</span> <span class="fl">1e-6</span>)).astype(np.float32)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># corr = cv2.matchTemplate(seg_norm, tmpl_norm, cv2.TM_CCOEFF_NORMED)[0][0]</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>        corr <span class="op">=</span> np.mean(seg_norm <span class="op">*</span> tmpl_norm)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> corr <span class="op">&gt;</span> best_corr:</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>            best_corr <span class="op">=</span> corr</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>            best_label <span class="op">=</span> label</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    results.append([fname, best_label, <span class="bu">round</span>(<span class="bu">float</span>(best_corr), <span class="dv">4</span>)])</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>fname<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>best_label<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>best_corr<span class="sc">:.4f}</span><span class="ss">)&quot;</span>)</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(OUTPUT_CSV, <span class="st">&quot;w&quot;</span>, newline<span class="op">=</span><span class="st">&quot;&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    writer <span class="op">=</span> csv.writer(f)</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    writer.writerow([<span class="st">&quot;segment_file&quot;</span>, <span class="st">&quot;prediction_label&quot;</span>, <span class="st">&quot;correlation&quot;</span>])</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    writer.writerows(results)</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Saved results to </span><span class="sc">{</span>OUTPUT_CSV<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>noisy_2hr_02_char_0.png: 2 (0.7949)
noisy_2hr_02_char_1.png: h (0.8268)
noisy_2hr_02_char_2.png: r (0.8522)
noisy_83z_01_char_0.png: 8 (0.7641)
noisy_83z_01_char_1.png: 3 (0.7338)
noisy_83z_01_char_2.png: z (0.8114)
noisy_hfx_05_char_0.png: h (0.8261)
noisy_hfx_05_char_1.png: h (0.3394)
noisy_j1k_07_char_0.png: j (0.6860)
noisy_j1k_07_char_1.png: 1 (0.7918)
noisy_j1k_07_char_2.png: k (0.8117)
noisy_jth_06_char_0.png: j (0.6697)
noisy_jth_06_char_1.png: t (0.7704)
noisy_jth_06_char_2.png: h (0.8106)
noisy_l5s_04_char_0.png: 9 (0.2825)
noisy_l5s_04_char_1.png: 5 (0.6833)
noisy_l5s_04_char_2.png: s (0.7175)
noisy_nd0_08_char_0.png: n (0.8186)
noisy_nd0_08_char_1.png: d (0.8243)
noisy_nd0_08_char_2.png: o (0.8412)
noisy_pkn_00_char_0.png: p (0.8196)
noisy_pkn_00_char_1.png: k (0.8220)
noisy_pkn_00_char_2.png: n (0.8523)
noisy_qch_09_char_0.png: q (0.8189)
noisy_qch_09_char_1.png: c (0.7679)
noisy_qch_09_char_2.png: h (0.7668)
noisy_x0f_03_char_0.png: x (0.6701)
noisy_x0f_03_char_1.png: o (0.8161)
noisy_x0f_03_char_2.png: f (0.7565)

Saved results to char_predictions.csv
</code></pre>
</div>
</div>
<div id="3f5c5928" class="cell code" data-execution_count="90">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(OUTPUT_CSV)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>sample_df <span class="op">=</span> df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="va">None</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === display images with predictions ===</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> sample_df.iterrows():</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    img_path <span class="op">=</span> os.path.join(OUT_CHAR_DIR, row[<span class="st">&quot;segment_file&quot;</span>])</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(img_path, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">5</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    plt.imshow(img, cmap<span class="op">=</span><span class="st">&quot;gray&quot;</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&quot;</span><span class="sc">{</span>row[<span class="st">&#39;prediction_label&#39;</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>row[<span class="st">&#39;correlation&#39;</span>]<span class="sc">:.2f}</span><span class="ss">)&quot;</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">&quot;off&quot;</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="06c8762d08d242fea7e546eab832a4df7f1b8ed8.png" /></p>
</div>
</div>
</body>
</html>
